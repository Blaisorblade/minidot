%{ ------- language ----- }%

tpe: type.
dec: type.
topt: type.

top: tpe.
tbind: dec -> tpe.
tsel: tpe.

tnone: topt.
tsome: tpe -> topt.

rect: topt -> tpe -> dec.

%{ ------- environments ----- }%

% environments
tenv  : type.
tnil  : tenv.
tcons : dec -> tenv.

tlookup: tenv -> dec -> type.
tl  : tlookup (tcons D) D.

%{ ------- subtyping ------ }%

has-lower : dec -> tpe -> type.
has-lower/yes : has-lower (rect (tsome S) U) S.

has-upper : dec -> tpe -> type.
has-upper/yes : has-upper (rect _ U) U.

wf-tp : tenv -> tpe -> type.
wf-dc : tenv -> dec -> type.
sub-tp : tenv -> tpe -> tenv -> tpe -> type.
sub-dc : tenv -> dec -> tenv -> dec -> type.

sub-tp/top : sub-tp G1 T G2 top -> wf-tp G1 T.
sub-tp/tsel1 : sub-tp G1 tsel G2 T2
            <- tlookup G1 D1
            <- tlookup G2 D2
            <- sub-dc G1 D1 G2 D2
            <- has-lower D1 S1
            <- sub-tp G1 S1 G2 T2
            .
sub-tp/tsel2 : sub-tp G1 T1 G2 tsel
            <- tlookup G1 D1
            <- tlookup G2 D2
            <- sub-dc G1 D1 G2 D2
            <- has-upper D1 U1
            <- sub-tp G1 T1 G2 U1 % NOTE(namin): fiddle with this as necessary for the proofs
            .
sub-tp/tbind : sub-tp G1 (tbind D1) G2 (tbind D2)
            <- sub-dc (tcons D1) D1 (tcons D2) D2
            .

%%% PROOFS %%%

